{% extends "base.html" %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto;">
    
    <div class="card" style="border-top: 4px solid var(--gold);">
        <h4 style="color: var(--gold); margin-bottom: 5px;">AGENDAMENTO</h4>
        <h2 style="color: white; margin-top: 0;">{{ service.name }}</h2>
        <p style="color: #888; font-size: 14px;">
            <span style="margin-right: 15px;">ðŸ“… {{ selected_date.strftime('%d/%m/%Y') }}</span>
            <span>ðŸ’° R$ {{ service.price }}</span>
        </p>

        <hr style="border-color: #333; margin: 25px 0;">

        <label style="color: #fff; margin-bottom: 10px; display: block;">Alterar Data:</label>
        <form method="GET" id="dateForm">
            <input type="date" name="date" value="{{ selected_date }}" min="{{ today }}" onchange="document.getElementById('dateForm').submit()">
        </form>

        <h3 style="color: white; font-size: 18px; margin-top: 30px;">HorÃ¡rios DisponÃ­veis:</h3>
        
        {% if available_slots %}
            <div class="time-grid">
                {% for slot in available_slots %}
                    <div class="time-slot" 
                         onclick="selectTime(this, '{{ url_for('confirm_booking', service_id=service.id, slot=slot.strftime('%Y-%m-%d_%H-%M-%S')) }}')">
                        {{ slot.strftime('%H:%M') }}
                    </div>
                {% endfor %}
            </div>

            <div class="action-buttons">
                <a href="{{ url_for('book_service') }}" class="btn btn-secondary" style="flex: 1; text-align: center;">
                    â¬… Voltar
                </a>

                <a id="btnConfirm" href="#" class="btn btn-confirm">
                    CONFIRMAR AGENDAMENTO âœ…
                </a>
            </div>

        {% else %}
            <div style="background: rgba(231, 76, 60, 0.1); border: 1px solid #e74c3c; padding: 20px; border-radius: 8px; text-align: center; margin-top: 20px;">
                <h3 style="color: #e74c3c; margin: 0 0 10px 0;">Agenda Cheia ðŸ˜”</h3>
                <p style="color: #ccc; font-size: 14px; margin: 0;">NÃ£o hÃ¡ horÃ¡rios vagos para esta data. Por favor, escolha outro dia acima.</p>
            </div>
            <div style="margin-top: 20px;">
                <a href="{{ url_for('book_service') }}" class="btn btn-secondary" style="width: 100%; text-align: center;">â¬… Voltar</a>
            </div>
        {% endif %}
    </div>
</div>

<script>
    function selectTime(element, url) {
        // 1. Remove a seleÃ§Ã£o visual de todos os horÃ¡rios
        document.querySelectorAll('.time-slot').forEach(el => el.classList.remove('selected'));
        
        // 2. Marca o horÃ¡rio clicado como selecionado (Fica Dourado)
        element.classList.add('selected');

        // 3. Configura o botÃ£o de confirmar
        const btnConfirm = document.getElementById('btnConfirm');
        btnConfirm.href = url;               // Define para onde o botÃ£o vai
        btnConfirm.classList.add('active');  // Ativa visualmente o botÃ£o
        btnConfirm.innerHTML = "CONFIRMAR (" + element.innerText + ") âœ…"; // Coloca a hora no texto do botÃ£o
    }
</script>
{% endblock %}