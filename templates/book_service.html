{% extends "base.html" %}

{% block content %}
<div style="max-width: 700px; margin: 0 auto;">
    
    <div style="text-align: center; margin-bottom: 40px;">
        <h4 style="color: var(--gold);">PASSO 2 DE 3</h4>
        <h2 style="color: white; font-size: 36px; margin-bottom: 10px;">AGENDAR: <span style="color: var(--gold);">{{ service.name }}</span></h2>
        <p style="color: #888;">Dura√ß√£o: {{ service.duration_minutes }} min ‚Ä¢ Valor: R$ {{ service.price }}</p>
    </div>

    <div class="card">
        <form method="GET" id="dateForm">
            <label style="color: var(--gold); margin-bottom: 10px; display: block;">1. ESCOLHA A DATA</label>
            <input type="date" name="date" value="{{ selected_date }}" min="{{ today }}" onchange="document.getElementById('dateForm').submit()">
        </form>

        <hr style="border: 0; border-top: 1px solid #333; margin: 30px 0;">

        <label style="color: var(--gold); margin-bottom: 15px; display: block;">2. ESCOLHA O HOR√ÅRIO PARA {{ selected_date.strftime('%d/%m') }}</label>
        
        {% if available_slots %}
            <div class="time-grid">
                {% for slot in available_slots %}
                    <div class="time-btn" 
                         onclick="selectTime(this, '{{ url_for('confirm_booking', service_id=service.id, slot=slot.strftime('%Y-%m-%d_%H-%M-%S')) }}')">
                        {{ slot.strftime('%H:%M') }}
                    </div>
                {% endfor %}
            </div>
            
            <div style="margin-top: 30px;">
                <a id="confirmButton" href="#" class="btn btn-primary btn-confirm">
                    CONFIRMAR AGENDAMENTO ‚ûú
                </a>
            </div>

        {% else %}
            <div style="text-align: center; padding: 40px; background: #221111; border: 1px solid #500; border-radius: 8px;">
                <h3 style="color: #e74c3c; margin-bottom: 10px;">Agenda Lotada üòî</h3>
                <p style="color: #ccc;">N√£o h√° hor√°rios dispon√≠veis para esta data.</p>
                <p style="color: #ccc;">Por favor, selecione outro dia no calend√°rio acima.</p>
            </div>
        {% endif %}
    </div>

    <div style="text-align: center; margin-top: 20px;">
        <a href="{{ url_for('book_service') }}" style="color: #666; font-size: 14px;">‚¨Ö Voltar aos Servi√ßos</a>
    </div>
</div>

<script>
    function selectTime(element, url) {
        // 1. Remove a classe 'selected' de todos os bot√µes
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.classList.remove('selected');
        });

        // 2. Adiciona 'selected' apenas ao bot√£o clicado (fica Dourado)
        element.classList.add('selected');

        // 3. Ativa o bot√£o de confirmar e coloca o link correto
        const confirmBtn = document.getElementById('confirmButton');
        confirmBtn.href = url;
        confirmBtn.classList.add('active');
    }
</script>
{% endblock %}